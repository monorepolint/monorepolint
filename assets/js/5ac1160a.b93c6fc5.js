"use strict";(self.webpackChunk_monorepolint_docs=self.webpackChunk_monorepolint_docs||[]).push([[945],{1643:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var i=t(6364);const s={},l=i.createContext(s);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(l.Provider,{value:n},e.children)}},3159:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"rules/file-contents","title":"fileContents","description":"Enforce that each package has a file with certain contents enforced by either a template or generator.","source":"@site/docs/rules/file-contents.md","sourceDirName":"rules","slug":"/rules/file-contents","permalink":"/docs/rules/file-contents","draft":false,"unlisted":false,"editUrl":"https://github.com/monorepolint/monorepolint/edit/main/packages/docs/docs/rules/file-contents.md","tags":[],"version":"current","frontMatter":{"title":"fileContents"},"sidebar":"docs","previous":{"title":"consistentVersions","permalink":"/docs/rules/consistent-versions"},"next":{"title":"forceError","permalink":"/docs/rules/force-error"}}');var s=t(1360),l=t(1643);const r={title:"fileContents"},o=void 0,a={},c=[{value:"Options",id:"options",level:3},{value:"REMOVE Symbol Support",id:"remove-symbol-support",level:3},{value:"Path Validation and Security",id:"path-validation-and-security",level:3},{value:"Generator Error Handling",id:"generator-error-handling",level:3},{value:"Example",id:"example",level:3},{value:"Use Cases",id:"use-cases",level:3}];function d(e){const n={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Enforce that each package has a file with certain contents enforced by either a template or generator."}),"\n",(0,s.jsx)(n.h3,{id:"options",children:"Options"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"file"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Name of the file"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"generator"})," (Optional)","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Function that can generate the file"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"template"})," (Optional)","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Expected file contents"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"templateFile"})," (Optional)","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Path to a file to use as a template"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Exactly one of ",(0,s.jsx)(n.code,{children:"generator"}),", ",(0,s.jsx)(n.code,{children:"template"}),", or ",(0,s.jsx)(n.code,{children:"templateFile"})," needs to be specified."]}),"\n",(0,s.jsx)(n.h3,{id:"remove-symbol-support",children:"REMOVE Symbol Support"}),"\n",(0,s.jsxs)(n.p,{children:["You can use the ",(0,s.jsx)(n.code,{children:"REMOVE"})," symbol to delete files from packages:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'import { fileContents, REMOVE } from "@monorepolint/rules";\n'})}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"template: REMOVE"})," is specified:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The rule will only report an error if the file exists"}),"\n",(0,s.jsx)(n.li,{children:"Fixing will delete the file from the package"}),"\n",(0,s.jsx)(n.li,{children:"No error is reported if the file already doesn't exist"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"path-validation-and-security",children:"Path Validation and Security"}),"\n",(0,s.jsx)(n.p,{children:"The rule includes path validation to prevent directory traversal attacks:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Paths containing ",(0,s.jsx)(n.code,{children:".."})," are rejected"]}),"\n",(0,s.jsx)(n.li,{children:"Absolute paths are rejected"}),"\n",(0,s.jsx)(n.li,{children:"Only relative paths within the package are allowed"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"generator-error-handling",children:"Generator Error Handling"}),"\n",(0,s.jsxs)(n.p,{children:["When using a ",(0,s.jsx)(n.code,{children:"generator"})," function:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If the generator throws an error, the rule will report it as a validation error"}),"\n",(0,s.jsx)(n.li,{children:"The error message will include both the original generator error and context about which package failed"}),"\n",(0,s.jsx)(n.li,{children:"This helps identify configuration issues or package-specific problems"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'import { fileContents, REMOVE } from "@monorepolint/rules";\nexport default {\n  rules: [\n    fileContents({\n      options: {\n        file: "jest.config.js",\n        templateFile: "./templates/jest.config.js",\n      },\n    }),\n    fileContents({\n      options: {\n        file: "foo.txt",\n        template: "Hi mom",\n      },\n    }),\n    // Remove deprecated config files\n    fileContents({\n      options: {\n        file: "jest.config.cjs",\n        template: REMOVE,\n      },\n    }),\n    // Delete file (legacy syntax - still supported)\n    fileContents({\n      options: {\n        file: "old-config.js",\n        template: undefined, // delete file\n      },\n    }),\n    // Generator example\n    fileContents({\n      options: {\n        file: "generated.txt",\n        generator: (context) => {\n          return `Package: ${context.packageJson.name}\\nVersion: ${context.packageJson.version}`;\n        },\n      },\n    }),\n    // Generator that removes files conditionally\n    fileContents({\n      options: {\n        file: "conditional.txt",\n        generator: (context) => {\n          // Remove file for certain packages\n          if (context.packageJson.name?.startsWith("@internal/")) {\n            return REMOVE;\n          }\n          return "This is a public package";\n        },\n      },\n    }),\n  ],\n};\n'})}),"\n",(0,s.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File Cleanup"}),": Remove deprecated configuration files across all packages:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'// Remove old Jest configs when migrating to Vitest\nfileContents({\n  options: {\n    file: "jest.config.js",\n    template: REMOVE,\n  },\n});\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Conditional File Management"}),": Use generators to conditionally create or remove files:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'// Only create README files for public packages\nfileContents({\n  options: {\n    file: "README.md",\n    generator: (context) => {\n      if (context.packageJson.private) {\n        return REMOVE;\n      }\n      return `# ${context.packageJson.name}\\n\\n${context.packageJson.description}`;\n    },\n  },\n});\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/monorepolint/monorepolint/blob/main/packages/rules/src/fileContents.ts",children:"rule source"})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);